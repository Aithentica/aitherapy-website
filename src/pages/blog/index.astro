---
import { getCollection } from 'astro:content';
import PageLayout from '../../layouts/PageLayout.astro';

const posts = (await getCollection('blog', ({ data }) => !data.draft))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const formatDate = (date: Date) =>
  date.toLocaleDateString('pl-PL', { year: 'numeric', month: 'long', day: 'numeric' });

const categoryColors: Record<string, string> = {
  'Inne': 'bg-gray-100 text-gray-700',
  'Artyku≈Çy Naukowe': 'bg-blue-50 text-blue-700',
  'Wydarzenia': 'bg-sage-50 text-sage-700',
};
---

<PageLayout
  title="Blog"
  description="Artykuly, aktualnosci i badania naukowe z zakresu AI w psychoterapii."
>
  <section class="max-w-6xl mx-auto px-4 sm:px-6 py-12 sm:py-20">
    <header class="mb-12 text-center">
      <h1 class="text-4xl sm:text-5xl font-bold mb-4">Blog</h1>
      <p class="text-lg text-gray-600 max-w-2xl mx-auto">
        Aktualnosci, artykuly naukowe i wydarzenia ze swiata AI w psychoterapii.
      </p>
    </header>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      {posts.map((post) => (
        <a
          href={`/blog/${post.slug}/`}
          class="group block bg-white rounded-2xl border border-gray-100 shadow-sm hover:shadow-md transition-shadow overflow-hidden"
        >
          {post.data.heroImage && (
            <div class="aspect-[16/9] overflow-hidden bg-gray-100">
              <img
                src={post.data.heroImage}
                alt={post.data.title}
                class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
              />
            </div>
          )}
          <div class="p-6">
            <div class="flex items-center gap-3 mb-3">
              <span class={`text-xs font-medium px-2.5 py-1 rounded-full ${categoryColors[post.data.category] || 'bg-gray-100 text-gray-700'}`}>
                {post.data.category}
              </span>
              <time
                datetime={post.data.pubDate.toISOString()}
                class="text-xs text-gray-400"
              >
                {formatDate(post.data.pubDate)}
              </time>
            </div>
            <h2 class="text-lg font-bold mb-2 group-hover:text-sage-600 transition-colors line-clamp-3">
              {post.data.title}
            </h2>
            <p class="text-sm text-gray-500 line-clamp-3">
              {post.data.description}
            </p>
            <div class="mt-4 text-sm font-medium text-sage-600 group-hover:text-sage-700 transition-colors">
              Czytaj dalej &rarr;
            </div>
          </div>
        </a>
      ))}
    </div>
  </section>
</PageLayout>
