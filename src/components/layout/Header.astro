---
import Navigation from './Navigation.astro';
import MobileMenu from './MobileMenu.astro';

interface Props {
  transparent?: boolean;
}

const { transparent = false } = Astro.props;
---

<header
  class:list={[
    'sticky top-0 z-50 transition-all duration-300',
    transparent
      ? 'bg-transparent border-b border-transparent'
      : 'bg-white/80 backdrop-blur-md border-b border-gray-100',
  ]}
  id="site-header"
  data-transparent={transparent ? 'true' : 'false'}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16 lg:h-20 transition-all duration-300" id="header-inner">
      <!-- Logo -->
      <a href="/" class="flex-shrink-0">
        <img
          src="/images/logos/therapysupport-new.png"
          alt="Therapy Support"
          class="h-8 lg:h-10 w-auto"
        />
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden lg:flex items-center gap-6">
        <Navigation />
        <a
          href="https://app.aitherapy.support"
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center px-6 py-2.5 rounded-full bg-primary text-sage-900 font-bold text-sm hover:bg-white shadow-md hover:shadow-lg transition-all"
        >
          Logowanie
        </a>
      </div>

      <!-- Mobile Menu Button -->
      <button
        type="button"
        class="lg:hidden p-2 rounded-lg text-gray-600 hover:text-gray-900 hover:bg-gray-100 transition-colors"
        id="mobile-menu-toggle"
        aria-label="Otwórz menu"
        aria-expanded="false"
      >
        <svg class="w-6 h-6" id="menu-icon-open" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
        </svg>
        <svg class="w-6 h-6 hidden" id="menu-icon-close" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile Menu -->
  <MobileMenu />
</header>

<!-- Hidden element to ensure Tailwind includes dynamic classes -->
<span class="hidden bg-white/80 backdrop-blur-md border-gray-100 bg-transparent border-transparent lg:h-16"></span>

<script is:inline>
  const header = document.getElementById('site-header');
  const headerInner = document.getElementById('header-inner');
  const isTransparent = header.dataset.transparent === 'true';

  function updateHeader() {
    const scrolled = window.scrollY > 80;

    if (scrolled) {
      header.classList.add('bg-white/80', 'backdrop-blur-md', 'border-gray-100', 'shadow-sm');
      header.classList.remove('bg-transparent', 'border-transparent');
      headerInner.classList.remove('lg:h-20');
      headerInner.classList.add('lg:h-16');
    } else {
      headerInner.classList.add('lg:h-20');
      headerInner.classList.remove('lg:h-16');
      header.classList.remove('shadow-sm');

      if (isTransparent) {
        header.classList.add('bg-transparent', 'border-transparent');
        header.classList.remove('bg-white/80', 'backdrop-blur-md', 'border-gray-100');
      }
    }
  }

  window.addEventListener('scroll', updateHeader);
  updateHeader();

  // Mobile menu toggle
  const toggle = document.getElementById('mobile-menu-toggle');
  const mobileMenu = document.getElementById('mobile-menu');
  const iconOpen = document.getElementById('menu-icon-open');
  const iconClose = document.getElementById('menu-icon-close');

  toggle.addEventListener('click', () => {
    const isOpen = mobileMenu.classList.contains('hidden');
    mobileMenu.classList.toggle('hidden');
    iconOpen.classList.toggle('hidden');
    iconClose.classList.toggle('hidden');
    toggle.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
    toggle.setAttribute('aria-label', isOpen ? 'Zamknij menu' : 'Otwórz menu');

    // Force opaque header when mobile menu is open
    if (isOpen && isTransparent) {
      header.classList.add('bg-white/80', 'backdrop-blur-md', 'border-gray-100');
      header.classList.remove('bg-transparent', 'border-transparent');
    } else if (!isOpen && isTransparent && window.scrollY <= 80) {
      header.classList.add('bg-transparent', 'border-transparent');
      header.classList.remove('bg-white/80', 'backdrop-blur-md', 'border-gray-100');
    }
  });
</script>
